{% extends 'usuarios/base.html' %}

{% block 'titulo' %}Visualizar Estoque{% endblock %}

{% block 'conteudo' %}
<div class="container mt-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>Meu Estoque</h3>
        {# Botão para levar o usuário de volta à página de cadastro #}
        <a href="{% url 'lancar' %}" class="btn btn-success">Cadastrar Novo Produto</a>
    </div>

    {# Bloco para exibir mensagens de sucesso (como "Produto excluído!") ou de erro #}
    {% if messages %}
        {% for message in messages %}
            <div class="alert {{ message.tags }} text-center" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="card shadow-sm">
        <div class="card-body">
            {# O formulário usa o método GET, que é o correto para buscas #}
            <form action="{% url 'visualizar' %}" method="GET" class="row g-3 align-items-center mb-3">
                <div class="col-auto">
                    <label for="filtro_nome" class="visually-hidden">Filtrar por nome</label>
                    {# O 'name' deste input é "filtro_nome", que corresponde ao que a view espera #}
                    <input type="text" class="form-control" name="filtro_nome" id="filtro_nome" placeholder="Buscar por nome do produto...">
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Buscar</button>
                </div>
            </form>

            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">Produto</th>
                            <th scope="col">Quantidade</th>
                            <th scope="col">Preço de Custo</th>
                            <th scope="col">Preço de Venda</th>
                            <th scope="col">Fornecedor</th>
                            <th scope="col">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# AQUI É A PARTE MAIS IMPORTANTE: O loop que exibe os produtos. #}
                        {# A variável 'produtos' deve ser a mesma que você envia pela sua view. #}
                        {% for produto in produtos %}
                            <tr>
                                {# Exibe os dados de cada produto. Ex: produto.nome_produto #}
                                <td>{{ produto.nome_produto }}</td>
                                <td>{{ produto.quantidade }}</td>
                                <td>R$ {{ produto.preco_custo|stringformat:".2f" }}</td>
                                <td>R$ {{ produto.preco_venda|stringformat:".2f" }}</td>
                                <td>{{ produto.fornecedor|default:"--" }}</td>
                                <td>
                                    {# Botões que levam para as URLs de editar e excluir, passando o ID (pk) do produto #}
                                    <a href="{% url 'editar' produto.pk %}" class="btn btn-info btn-sm">Editar</a>
                                    <a href="{% url 'excluir' produto.pk %}" class="btn btn-danger btn-sm">Excluir</a>
                                </td>
                            </tr>
                        {% empty %}
                            {# Esta mensagem aparece se a lista de 'produtos' estiver vazia #}
                            <tr>
                                <td colspan="6" class="text-center py-3">
                                    Nenhum produto cadastrado no seu estoque ainda.
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}